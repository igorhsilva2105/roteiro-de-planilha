<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f5f5 0%, #fefefe 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 900px;
            padding: 30px;
            text-align: center;
        }
        .upload-area {
            border: 3px dashed #70ad47;
            border-radius: 12px;
            padding: 40px 20px;
            margin: 25px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f5f5f5;
            position: relative;
            overflow: hidden;
        }
        .upload-area:hover {
            background-color: #f0f0f0;
            border-color: #15c565;
        }
        .upload-area i {
            font-size: 50px;
            color: #f5872d;
            margin-bottom: 15px;
            font-style: normal;
        }
        .hidden {
            display: none;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-processing {
            background-color: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        .editorArea {
            height: 400px;
            overflow-y: auto;
            background-color: #ffffff;
            color: #333;
            border-radius: 12px;
            padding: 40px 20px;
            margin: 25px 0;
            position: relative;
        }
        .line {
            width: 100%;
            overflow-x: hidden;
            max-height: 30px;
            display: flex;
        }
        .line .lineNumber, .line .lineContent {
            text-align: left;
        }
        .line .lineNumber {
            width: 5%;
            text-align: center;
            color: #c6c6c6;
            padding: 5px;
        }
        .line .lineContent {
            width: 95%;
            padding: 5px;
            text-align: left;
            border-radius: 5px;
            cursor: text;
            display: flex;
            justify-content: start;
            align-items: center;
        }
        .line .lineContent input {
          max-width: 50px; 
          margin: 0px 5px;
          text-align: center;
        }
        .line:hover {
            background: #c6c6c62e;
        }
        .line:active {
            background-color: #70ad4757;
            border: 1px solid #c6c6c6;
        }
        .line .deleteLine {
           display: none;
           color: #e74c3c;
           font-weight: bold;
           margin-left: auto;
           padding: 5px;
           cursor: pointer;
           user-select: none;
           transition: opacity 0.2s ease;
        }
        .line:hover .deleteLine {
          display: block;
        }
        .previewButton {
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            background: #70ad47;
            color: #fff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .previewButton p, .previewButton i {
            font-style: normal;
            font-size: 20px;
            margin: 0 10px;
            text-align: center;
        }
        .context-menu {
          position: fixed;
          background-color: #fff;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          padding: 8px 0;
          z-index: 1000;
          min-width: 200px;
          max-height: 240px;
          overflow-y: scroll;
          display: none; /* Inicia oculto */
        }
/* Supondo que sua div tenha a classe 'minha-div' */
.context-menu::-webkit-scrollbar {
  width: 10px;
}
.context-menu::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 6px;
}
.context-menu::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #3cba54, #2f7d3f);
  border-radius: 6px;
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);
}
.context-menu::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #5a0fb8, #1565c0);
}
        .context-menu .menu-item {
          padding: 10px 15px;
          cursor: pointer;
          font-size: 14px;
          color: #333;
          transition: background-color 0.2s ease;
        }
        .context-menu .menu-item:hover {
          background-color: #f0f0f0;
        }
        .context-menu .menu-item.delete {
          color: #e74c3c;
        }
        .context-menu hr {
          border: none;
          border-top: 1px solid #eee;
          margin: 5px 0;
        }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="uploadArea" class="upload-area">
        <i>üìÅ</i>
        <h3>Arraste e solte sua planilha aqui</h3>
        <p>ou clique para selecionar um arquivo</p>
        <div id="fileName" class="file-name"></div>
        <input type="file" id="fileInput" accept=".xlsx, .xls" class="hidden">
      </div>
      <div id="status" class="status hidden"></div>
      <div class="editorArea">
        <div class="line">
          <p class="lineNumber">1</p><p class="lineContent" contenteditable="true">Editar linha</p>
        </div>
      </div>
      <div class="preview">
        <div class="previewButton">
          <p>Processar Planilhas</p>
          <i>‚öôÔ∏è</i>
        </div>
        <div id="tableContainer" class="table-container" style="display: none;"></div>
      </div>
    </div>
<div class="context-menu" id="contextMenu">
  <div class="menu-item" data-action="insertRowAbove">Inserir linhas acima da c√©lula</div>
  <div class="menu-item" data-action="insertRowBelow">Inserir linhas abaixo da c√©lula</div>
  <div class="menu-item" data-action="insertColRight">Inserir colunas √† direita da c√©lula</div>
  <div class="menu-item" data-action="insertColLeft">Inserir colunas √† esquerda da c√©lula</div>
  <div class="menu-item delete" data-action="deleteLine">Excluir Linha</div>
  <div class="menu-item delete" data-action="deleteCol">Excluir Coluna</div>
  <hr>
  <div class="menu-item" data-action="insertContent">Inserir Conte√∫do</div>
  <div class="menu-item" data-action="convertUMB">Converter unidade de medida</div>
  <div class="menu-item" data-action="clearContent">Limpar Conte√∫do</div>
  <hr>
  <div class="menu-item" data-action="sortAsc">Classificar em Ordem Crescente</div>
  <div class="menu-item" data-action="sortDesc">Classificar em Ordem Decrescente</div>
  <hr>
  <div class="menu-item" data-action="downloadPDF">Baixar planilha como PDF</div>
  <div class="menu-item" data-action="downloadJSON">Baixar planilha como JSON</div>
  <div class="menu-item" data-action="downloadJSON">Baixar planilha como HTML</div>
  <hr>
  <div class="menu-item" data-action="CPDF">Converter HTML para EXCEL</div>
  <div class="menu-item" data-action="rectJSON">Converter JSON para EXCEL</div>
  <div class="menu-item" data-action="rectTXT">Converter TXT para EXCEL</div>
  <hr>
  <div class="menu-item" data-action="SAPconnection"><i>Conex√£o SAP</i></div>
  <div class="menu-item" data-action="SAPconnection"><i>Abrir Transa√ß√£o SAP</i></div>
  <div class="menu-item" data-action="SAPconnection"><i>Preencher campos SAP</i></div>
</div>
<script>
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const fileName = document.getElementById('fileName');
  const editorArea = document.querySelector('.editorArea');
  const contextMenu = document.getElementById('contextMenu');
  const menuItems = contextMenu.querySelectorAll('.menu-item'); // Seleciona todos os itens do menu
  let currentLine = null;

  // Fun√ß√£o para exibir mensagens na √°rea de status
  function logStatus(type, message) {
    const statusDiv = document.getElementById('status');
    statusDiv.classList.remove('hidden', 'status-success', 'status-error', 'status-processing');

    switch (type) {
      case 'success':
        statusDiv.classList.add('status-success');
        break;
      case 'error':
        statusDiv.classList.add('status-error');
        break;
      case 'processing':
        statusDiv.classList.add('status-processing');
        break;
    }
    statusDiv.textContent = message;
  }

  // Tratamento do clique para abrir o seletor de arquivos
  uploadArea.addEventListener('click', () => fileInput.click());

  // Verifica√ß√£o de tipo de arquivo ao selecionar
  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (!file) {
      logStatus('error', 'Nenhum arquivo selecionado.');
      return;
    }
    const allowedTypes = ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
    if (!allowedTypes.includes(file.type)) {
      logStatus('error', 'Formato inv√°lido. Por favor, envie um arquivo .xls ou .xlsx.');
      fileInput.value = ''; // Limpa o input
      return;
    }
    fileName.textContent = `üìÑ ${file.name}`;
    logStatus('success', 'Arquivo v√°lido! Pronto para processar.');
  });

  // Fun√ß√£o para re-numerar as linhas
  function renumberLines() {
    const lines = document.querySelectorAll('.line');
    lines.forEach((line, index) => {
      const number = line.querySelector('.lineNumber');
      if (number) number.textContent = index + 1;
    });
  }

  // Fun√ß√£o para posicionar o cursor no final do conte√∫do
  function placeCursorAtEnd(el) {
    const range = document.createRange();
    const sel = window.getSelection();
    range.selectNodeContents(el);
    range.collapse(false);
    sel.removeAllRanges();
    sel.addRange(range);
  }

  // Fun√ß√£o unificada para criar nova linha
  function createNewLine(referenceLineElement, insertAbove = false) {
    const newLine = document.createElement('div');
    newLine.className = 'line';
    newLine.innerHTML = `
      <p class="lineNumber"></p>
      <p class="lineContent" contenteditable="true">Editar linha</p>
      <p class="deleteLine">üóëÔ∏è</p>
    `;
    if (insertAbove) {
      referenceLineElement.before(newLine);
    } else {
      referenceLineElement.insertAdjacentElement('afterend', newLine);
    }
    renumberLines();
    const newContent = newLine.querySelector('.lineContent');
    newContent.focus();
    placeCursorAtEnd(newContent);
    return newLine;
  }

  // Listener para detec√ß√£o de Enter
  editorArea.addEventListener('keydown', (e) => {
    if (e.target.classList.contains('lineContent') && e.key === 'Enter') {
      e.preventDefault();
      const currentLine = e.target.closest('.line');
      createNewLine(currentLine);
    }
  });

  // Listener principal para o editor (gerencia todos os cliques na √°rea do editor)
  editorArea.addEventListener('click', (e) => {
    const lineElement = e.target.closest('.line');
    
    // Oculta o menu se o clique n√£o for em uma linha
    if (!lineElement) {
      contextMenu.style.display = 'none';
      return;
    }

    // Se o clique for na lixeira, remove a linha e sai da fun√ß√£o
    if (e.target.classList.contains('deleteLine')) {
      lineElement.remove();
      renumberLines();
      contextMenu.style.display = 'none';
      return;
    }

    // L√≥gica para exibir o menu de contexto
    e.preventDefault(); // Impede o comportamento padr√£o de foco
    currentLine = lineElement;
    
    const rect = lineElement.getBoundingClientRect();
    contextMenu.style.top = `${rect.bottom + window.scrollY}px`;
    contextMenu.style.left = `${rect.left + window.scrollX}px`;
    contextMenu.style.display = 'block';

    // L√≥gica para focar a linha para edi√ß√£o
    const content = lineElement.querySelector('.lineContent');
    if (content.textContent.trim() === "Editar linha") {
        content.textContent = "";
    }
    content.focus();
    placeCursorAtEnd(content);
  });
  
  // Listener de clique nas op√ß√µes do menu
  contextMenu.addEventListener('click', (e) => {
    const action = e.target.dataset.action;
    if (!currentLine || !action) return;
    const lineFocus = currentLine;

    switch (action) {
  case 'insertRowAbove':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1"> linhas acima da c√©lula <input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'insertRowBelow':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1"> linhas abaixo da c√©lula <input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'insertColRight':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1"> linhas a direita da c√©lula <input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'insertColLeft':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1"> linhas a esquerda da c√©lula <input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'deleteLine':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Excluir linhas <input placeholder="1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'deleteCol':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Excluir coluna <input placeholder="A"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'insertContent':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir conte√∫do <input placeholder="texto">na c√©lula<input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'clearContent':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Limpar conte√∫do da c√©lula<input placeholder="A1"></p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'sortAsc':
    break;
  case 'sortDesc':
    break;
  case 'downloadPDF':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como PDF üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
  case 'downloadJSON':
    lineFocus.innerHTML = `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como JSON üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`
    createNewLine(currentLine);
    break;
}
    contextMenu.style.display = 'none';
    resetFilter(); // Reseta o filtro ao selecionar uma op√ß√£o
  });

  // Esconde o menu se o usu√°rio clicar fora dele
  document.addEventListener('click', (e) => {
    if (!contextMenu.contains(e.target) && !e.target.closest('.line')) {
      contextMenu.style.display = 'none';
      resetFilter(); // Reseta o filtro ao fechar o menu
    }
  });

  // Listener para gerenciar a edi√ß√£o do texto
  editorArea.addEventListener('focus', (e) => {
    if (e.target.classList.contains('lineContent')) {
      if (e.target.textContent.trim() === "Editar linha") {
        e.target.textContent = "";
      }
    }
  }, true);

  editorArea.addEventListener('blur', (e) => {
    if (e.target.classList.contains('lineContent')) {
      if (e.target.textContent.trim() === "") {
        e.target.textContent = "Editar linha";
      }
    }
  }, true);
  
  // ----------------------------------------------------
  // C√ìDIGO PARA A FUNCIONALIDADE DE FILTRO
  // ----------------------------------------------------

  // Fun√ß√£o para aplicar o filtro
  function applyFilter(filterText) {
    const filterLower = filterText.toLowerCase().trim();
    if (filterLower.length > 0) {
      menuItems.forEach(item => {
        const itemText = item.textContent.toLowerCase();
        if (itemText.includes(filterLower)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    } else {
      // Se o filtro estiver vazio, mostra todos os itens
      resetFilter();
    }
  }

  // Fun√ß√£o para remover o filtro e mostrar todos os itens
  function resetFilter() {
    menuItems.forEach(item => {
      item.style.display = 'block';
    });
  }

  // Listener para filtrar o menu enquanto o usu√°rio digita na linha
  editorArea.addEventListener('input', (e) => {
    if (contextMenu.style.display === 'block' && e.target.classList.contains('lineContent')) {
      const filterValue = e.target.textContent;
      if (filterValue.length > 0) {
        applyFilter(filterValue);
      } else {
        resetFilter();
      }
    }
  });

</script>
</body>
</html>
