<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f5f5 0%, #fefefe 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 900px;
            padding: 30px;
            text-align: center;
        }
        .upload-area {
            border: 3px dashed #70ad47;
            border-radius: 12px;
            padding: 40px 20px;
            margin: 25px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f5f5f5;
            position: relative;
            overflow: hidden;
        }
        .upload-area:hover {
            background-color: #f0f0f0;
            border-color: #15c565;
        }
        .upload-area i {
            font-size: 50px;
            color: #f5872d;
            margin-bottom: 15px;
            font-style: normal;
        }
        .hidden {
            display: none;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-processing {
            background-color: #cce5ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        .editorArea {
            height: 400px;
            overflow-y: auto;
            background-color: #ffffff;
            color: #333;
            border-radius: 12px;
            padding: 40px 20px;
            margin: 25px 0;
            position: relative;
        }
        .line {
            width: 100%;
            overflow-x: hidden;
            max-height: 30px;
            display: flex;
        }
        .line .lineNumber, .line .lineContent {
            text-align: left;
        }
        .line .lineNumber {
            width: 5%;
            text-align: center;
            color: #c6c6c6;
            padding: 5px;
        }
        .line .lineContent {
            width: 95%;
            padding: 5px;
            text-align: left;
            border-radius: 5px;
            cursor: text;
            display: flex;
            justify-content: start;
            align-items: center;
        }
        .line .lineContent input {
          max-width: 50px; 
          margin: 0px 5px;
          text-align: center;
        }
        .line:hover {
            background: #c6c6c62e;
        }
        .line:active {
            background-color: #70ad4757;
            border: 1px solid #c6c6c6;
        }
        .line .deleteLine {
           display: none;
           color: #e74c3c;
           font-weight: bold;
           margin-left: auto;
           padding: 5px;
           cursor: pointer;
           user-select: none;
           transition: opacity 0.2s ease;
        }
        /* Nova regra para ocultar o bot√£o de exclus√£o da primeira linha */
        .editorArea .line:first-child .deleteLine {
           display: none !important;
        }
        .line:hover .deleteLine {
          display: block;
        }
        .previewButton {
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            background: #70ad47;
            color: #fff;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .previewButton p, .previewButton i {
            font-style: normal;
            font-size: 20px;
            margin: 0 10px;
            text-align: center;
        }
        .context-menu {
          position: fixed;
          background-color: #fff;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          padding: 8px 0;
          z-index: 1000;
          min-width: 200px;
          max-height: 240px;
          overflow-y: scroll;
          display: none;
        }
/* Supondo que sua div tenha a classe 'minha-div' */
.context-menu::-webkit-scrollbar {
  width: 10px;
}
.context-menu::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 6px;
}
.context-menu::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #3cba54, #2f7d3f);
  border-radius: 6px;
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.2);
}
.context-menu::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #5a0fb8, #1565c0);
}
        .context-menu .menu-item {
          padding: 10px 15px;
          cursor: pointer;
          font-size: 14px;
          color: #333;
          transition: background-color 0.2s ease;
        }
        .context-menu .menu-item:hover {
          background-color: #f0f0f0;
        }
        .context-menu .menu-item.delete {
          color: #e74c3c;
        }
        .context-menu hr {
          border: none;
          border-top: 1px solid #eee;
          margin: 5px 0;
        }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="uploadArea" class="upload-area">
        <i>üìÅ</i>
        <h3>Arraste e solte sua planilha aqui</h3>
        <p>ou clique para selecionar um arquivo</p>
        <div id="fileName" class="file-name"></div>
        <input type="file" id="fileInput" accept=".xlsx, .xls" class="hidden">
      </div>
      <div id="status" class="status hidden"></div>
      <div class="editorArea">
        <div class="line">
          <p class="lineNumber">1</p><p class="lineContent" contenteditable="true">Editar linha</p>
          <p class="deleteLine">üóëÔ∏è</p>
        </div>
      </div>
      <div class="preview">
        <div class="previewButton">
          <p>Processar Planilhas</p>
          <i>‚öôÔ∏è</i>
        </div>
        <div id="tableContainer" class="table-container" style="display: none;"></div>
      </div>
    </div>
<div class="context-menu" id="contextMenu">
  <div class="menu-item" data-action="insert-row-above">Inserir linhas acima da c√©lula</div>
  <div class="menu-item" data-action="insert-row-below">Inserir linhas abaixo da c√©lula</div>
  <div class="menu-item" data-action="insert-col-right">Inserir colunas √† direita da c√©lula</div>
  <div class="menu-item" data-action="insert-col-left">Inserir colunas √† esquerda da c√©lula</div>
  <div class="menu-item delete" data-action="delete-row">Excluir Linha</div>
  <div class="menu-item delete" data-action="delete-col">Excluir Coluna</div>
  <hr>

  <div class="menu-item" data-action="insert-content">Inserir Conte√∫do</div>
  <div class="menu-item" data-action="clear-content">Limpar Conte√∫do</div>
  <div class="menu-item" data-action="convert-unit">Converter unidade de medida</div>
  <div class="menu-item" data-action="split-text">Dividir texto em colunas</div>
  <div class="menu-item" data-action="merge-cells">Unir c√©lulas</div>
  <div class="menu-item" data-action="reformat-data">Reformatar dados</div>
  <hr>

  <div class="menu-item" data-action="find-and-replace">Localizar e substituir</div>
  <div class="menu-item" data-action="remove-duplicates">Remover duplicados</div>
  <div class="menu-item" data-action="data-validation">Valida√ß√£o de dados</div>
  <hr>

  <div class="menu-item" data-action="sort-col-asc">Classificar coluna em Ordem Crescente</div>
  <div class="menu-item" data-action="sort-col-desc">Classificar coluna em Ordem Decrescente</div>
  <div class="menu-item" data-action="sort-row-asc">Classificar linha em Ordem Crescente</div>
  <div class="menu-item" data-action="sort-row-desc">Classificar linha em Ordem Decrescente</div>
  <hr>

  <div class="menu-item" data-action="download-xlsx">Baixar planilha como XLSX</div>
  <div class="menu-item" data-action="download-pdf">Baixar planilha como PDF</div>
  <div class="menu-item" data-action="download-json">Baixar planilha como JSON</div>
  <div class="menu-item" data-action="download-html">Baixar planilha como HTML</div>
  <div class="menu-item" data-action="download-csv">Baixar planilha como CSV</div>
  <div class="menu-item" data-action="download-xml">Baixar planilha como XML</div>
  <hr>

  <div class="menu-item" data-action="convert-html-to-excel">Converter HTML para EXCEL</div>
  <div class="menu-item" data-action="convert-json-to-excel">Converter JSON para EXCEL</div>
  <div class="menu-item" data-action="convert-txt-to-excel">Converter TXT para EXCEL</div>
  <hr>

  <div class="menu-item" data-action="connect-sap"><i>Conex√£o SAP</i></div>
  <div class="menu-item" data-action="open-sap-transaction"><i>Abrir Transa√ß√£o SAP</i></div>
  <div class="menu-item" data-action="fill-sap-fields"><i>Preencher campos SAP</i></div>
  <hr>

  <div class="menu-item" data-action="wait-for-upload">Aguardar Upload de planilha</div>
  <div class="menu-item" data-action="preview-data">Pr√©-visualizar dados</div>
  <div class="menu-item" data-action="add-comment">Fazer um coment√°rio</div>
  <div class="menu-item" data-action="insert-custom-code">Inserir c√≥digo personalizado</div>
  <div class="menu-item" data-action="save-script">Salvar Roteiro</div>
  <hr>

  <div class="menu-item" data-action="generate-report">Gerar Relat√≥rio</div>
  <div class="menu-item" data-action="send-email">Enviar por E-mail</div>
</div>
<script>
  const uploadArea = document.getElementById('uploadArea');
  const fileInput = document.getElementById('fileInput');
  const fileName = document.getElementById('fileName');
  const editorArea = document.querySelector('.editorArea');
  const contextMenu = document.getElementById('contextMenu');
  const menuItems = contextMenu.querySelectorAll('.menu-item');
  const previewButton = document.querySelector('.previewButton');
  let currentLine = null;
  
  // Array para armazenar as a√ß√µes do script
  const scriptActions = [];

  function logStatus(type, message) {
    const statusDiv = document.getElementById('status');
    statusDiv.classList.remove('hidden', 'status-success', 'status-error', 'status-processing');

    switch (type) {
      case 'success':
        statusDiv.classList.add('status-success');
        break;
      case 'error':
        statusDiv.classList.add('status-error');
        break;
      case 'processing':
        statusDiv.classList.add('status-processing');
        break;
    }
    statusDiv.textContent = message;
  }

  uploadArea.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (!file) {
      logStatus('error', 'Nenhum arquivo selecionado.');
      return;
    }
    const allowedTypes = ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
    if (!allowedTypes.includes(file.type)) {
      logStatus('error', 'Formato inv√°lido. Por favor, envie um arquivo .xls ou .xlsx.');
      fileInput.value = '';
      return;
    }
    fileName.textContent = `üìÑ ${file.name}`;
    logStatus('success', 'Arquivo v√°lido! Pronto para processar.');
  });

  function renumberLines() {
    const lines = document.querySelectorAll('.line');
    lines.forEach((line, index) => {
      const number = line.querySelector('.lineNumber');
      if (number) number.textContent = index + 1;
    });
  }

  function placeCursorAtEnd(el) {
    const range = document.createRange();
    const sel = window.getSelection();
    range.selectNodeContents(el);
    range.collapse(false);
    sel.removeAllRanges();
    sel.addRange(range);
  }

  function createNewLine(referenceLineElement, insertAbove = false) {
    const newLine = document.createElement('div');
    newLine.className = 'line';
    newLine.innerHTML = `
      <p class="lineNumber"></p>
      <p class="lineContent" contenteditable="true">Editar linha</p>
      <p class="deleteLine">üóëÔ∏è</p>
    `;
    if (insertAbove) {
      referenceLineElement.before(newLine);
    } else {
      referenceLineElement.insertAdjacentElement('afterend', newLine);
    }
    renumberLines();
    const newContent = newLine.querySelector('.lineContent');
    newContent.focus();
    placeCursorAtEnd(newContent);
    return newLine;
  }
  
  editorArea.addEventListener('keydown', (e) => {
    if (e.target.classList.contains('lineContent') && e.key === 'Enter') {
      e.preventDefault();
      const currentLine = e.target.closest('.line');
      createNewLine(currentLine);
    }
  });

  editorArea.addEventListener('click', (e) => {
    const lineElement = e.target.closest('.line');
    
    if (!lineElement) {
      contextMenu.style.display = 'none';
      return;
    }

    if (e.target.classList.contains('deleteLine')) {
      if (lineElement.isSameNode(editorArea.firstElementChild)) {
        alert("A primeira linha n√£o pode ser exclu√≠da.");
        return;
      }
      
      // Remove a a√ß√£o correspondente do array antes de remover a linha
      const lineIndex = Array.from(editorArea.children).indexOf(lineElement);
      if (lineIndex > -1) {
          scriptActions.splice(lineIndex, 1);
      }
      
      lineElement.remove();
      renumberLines();
      contextMenu.style.display = 'none';
      return;
    }

    e.preventDefault();
    currentLine = lineElement;
    
    const rect = lineElement.getBoundingClientRect();
    contextMenu.style.top = `${rect.bottom + window.scrollY}px`;
    contextMenu.style.left = `${rect.left + window.scrollX}px`;
    contextMenu.style.display = 'block';

    const content = lineElement.querySelector('.lineContent');
    if (content.textContent.trim() === "Editar linha") {
        content.textContent = "";
    }
    content.focus();
    placeCursorAtEnd(content);
  });
  
  editorArea.addEventListener('dblclick', (e) => {
    const lineElement = e.target.closest('.line');
    if (lineElement) {
      const lineContent = lineElement.querySelector('.lineContent');
      if (lineContent && lineContent.dataset.action) {
        // Remove a a√ß√£o correspondente do array
        const lineIndex = Array.from(editorArea.children).indexOf(lineElement);
        if (lineIndex > -1) {
            scriptActions.splice(lineIndex, 1);
        }

        lineElement.innerHTML = `
          <p class="lineNumber"></p>
          <p class="lineContent" contenteditable="true">Editar linha</p>
          <p class="deleteLine">üóëÔ∏è</p>
        `;
        currentLine = lineElement;

        const rect = lineElement.getBoundingClientRect();
        contextMenu.style.top = `${rect.bottom + window.scrollY}px`;
        contextMenu.style.left = `${rect.left + window.scrollX}px`;
        contextMenu.style.display = 'block';

        renumberLines();

        const newContent = lineElement.querySelector('.lineContent');
        newContent.focus();
        placeCursorAtEnd(newContent);
      }
    }
  });
  
  const actionTemplates = {
    'insert-row-above': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1" data-input-name="rows"> linhas acima da c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'insert-row-below': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1" data-input-name="rows"> linhas abaixo da c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'insert-col-right': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1" data-input-name="cols"> colunas √† direita da c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'insert-col-left': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir <input placeholder="1" data-input-name="cols"> colunas √† esquerda da c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'delete-row': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Excluir linha(s) <input placeholder="1" data-input-name="rows"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'delete-col': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Excluir coluna(s) <input placeholder="A" data-input-name="col"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'insert-content': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Inserir conte√∫do <input placeholder="texto" data-input-name="content"> na c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'clear-content': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Limpar conte√∫do da c√©lula <input placeholder="A1" data-input-name="cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'find-and-replace': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Localizar <input placeholder="texto antigo" data-input-name="old_text"> e substituir por <input placeholder="novo texto" data-input-name="new_text"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'remove-duplicates': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Remover duplicados na coluna <input placeholder="A" data-input-name="col"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'data-validation': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Validar dados na coluna <input placeholder="A" data-input-name="col"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'split-text': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Dividir texto da coluna <input placeholder="A" data-input-name="col"> pelo delimitador <input placeholder="," data-input-name="delimiter"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'merge-cells': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Unir c√©lulas de <input placeholder="A1" data-input-name="start_cell"> at√© <input placeholder="B2" data-input-name="end_cell"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'reformat-data': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Reformatar dados da coluna <input placeholder="A" data-input-name="col"></p><p class="deleteLine">üóëÔ∏è</p>`,
    'sort-col-asc': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Classificar coluna <input placeholder="A" data-input-name="col"> em ordem crescente</p><p class="deleteLine">üóëÔ∏è</p>`,
    'sort-col-desc': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Classificar coluna <input placeholder="A" data-input-name="col"> em ordem decrescente</p><p class="deleteLine">üóëÔ∏è</p>`,
    'sort-row-asc': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Classificar linha <input placeholder="1" data-input-name="row"> em ordem crescente</p><p class="deleteLine">üóëÔ∏è</p>`,
    'sort-row-desc': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Classificar linha <input placeholder="1" data-input-name="row"> em ordem decrescente</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-xlsx': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como XLSX üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-pdf': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como PDF üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-json': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como JSON üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-html': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como HTML üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-csv': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como CSV üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'download-xml': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Baixar como XML üóÉÔ∏è</p><p class="deleteLine">üóëÔ∏è</p>`,
    'convert-html-to-excel': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Converter HTML para EXCEL üîÑ</p><p class="deleteLine">üóëÔ∏è</p>`,
    'convert-json-to-excel': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Converter JSON para EXCEL üîÑ</p><p class="deleteLine">üóëÔ∏è</p>`,
    'convert-txt-to-excel': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Converter TXT para EXCEL üîÑ</p><p class="deleteLine">üóëÔ∏è</p>`,
    'generate-report': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Gerar relat√≥rio da planilha üìä</p><p class="deleteLine">üóëÔ∏è</p>`,
    'send-email': `<p class="lineNumber">1</p><p class="lineContent" data-action="true">Enviar planilha para <input placeholder="email@exemplo.com" data-input-name="email"></p><p class="deleteLine">üóëÔ∏è</p>`
  };

  contextMenu.addEventListener('click', (e) => {
    const action = e.target.dataset.action;
    if (!currentLine || !action) return;
    const lineFocus = currentLine;

    const template = actionTemplates[action];

    if (template) {
      lineFocus.innerHTML = template;
      
      const lineIndex = Array.from(editorArea.children).indexOf(lineFocus);
      const inputs = Array.from(lineFocus.querySelectorAll('input')).reduce((acc, input) => {
        acc[input.dataset.inputName] = input.value || input.placeholder;
        return acc;
      }, {});

      // Salva a a√ß√£o e os inputs no array
      scriptActions[lineIndex] = { action, inputs };
      
      createNewLine(currentLine);
    }
    
    contextMenu.style.display = 'none';
    resetFilter();
  });
  
  // Adiciona o evento de click no bot√£o de processar
  previewButton.addEventListener('click', () => {
    // Coleta as a√ß√µes preenchidas pelo usu√°rio
    const finalScriptActions = [];
    document.querySelectorAll('.line').forEach(line => {
        const actionElement = line.querySelector('.lineContent[data-action]');
        if (actionElement) {
            const action = line.querySelector('.menu-item').dataset.action;
            const inputs = Array.from(line.querySelectorAll('input')).reduce((acc, input) => {
                const name = input.dataset.inputName;
                const value = input.value || input.placeholder;
                if (name) {
                    acc[name] = value;
                }
                return acc;
            }, {});
            finalScriptActions.push({ action: action, inputs: inputs });
        }
    });

    console.log("Script de A√ß√µes Final:");
    console.log(finalScriptActions);
    alert("Processando planilhas... Verifique o console para ver o script de a√ß√µes.");
  });
  
  document.addEventListener('click', (e) => {
    if (!contextMenu.contains(e.target) && !e.target.closest('.line')) {
      contextMenu.style.display = 'none';
      resetFilter();
    }
  });

  editorArea.addEventListener('focus', (e) => {
    if (e.target.classList.contains('lineContent')) {
      if (e.target.textContent.trim() === "Editar linha") {
        e.target.textContent = "";
      }
    }
  }, true);

  editorArea.addEventListener('blur', (e) => {
    if (e.target.classList.contains('lineContent')) {
      if (e.target.textContent.trim() === "") {
        e.target.textContent = "Editar linha";
      }
    }
  }, true);
  
  function applyFilter(filterText) {
    const filterLower = filterText.toLowerCase().trim();
    if (filterLower.length > 0) {
      menuItems.forEach(item => {
        const itemText = item.textContent.toLowerCase();
        if (itemText.includes(filterLower)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    } else {
      resetFilter();
    }
  }

  function resetFilter() {
    menuItems.forEach(item => {
      item.style.display = 'block';
    });
  }

  editorArea.addEventListener('input', (e) => {
    if (contextMenu.style.display === 'block' && e.target.classList.contains('lineContent')) {
      const filterValue = e.target.textContent;
      if (filterValue.length > 0) {
        applyFilter(filterValue);
      } else {
        resetFilter();
      }
    }
  });

</script>
</body>
</html>
